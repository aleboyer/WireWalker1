function create_grid_ctd(Meta_Data)

load(fullfile(Meta_Data.L1path,['Profiles_' Meta_Data.deployment '.mat']),'CTDProfiles')


%get the normal upcast (mean P of the upcast ~ median P of all the mean P)
Profiles=CTDProfiles.dataup;

Prbr=cellfun(@(x) mean(x.P),Profiles);
critp= max(cellfun(@(x) max(x.P),Profiles))-.5*std(Prbr);
critm= min(cellfun(@(x) min(x.P),Profiles))+.5*std(Prbr);


timerbr=cellfun(@(x) mean(x.time),Profiles);
timerbrOK=timerbr(Prbr>critm & Prbr<critp);
indOK=(Prbr>critm & Prbr<critp);
Profiles=Profiles(indOK);
zaxis=0:.25:max(cellfun(@(x) max(x.P),Profiles));
Z=length(zaxis);

fields=fieldnames(Profiles{1});
for f=1:length(fields)
    wh_field=fields{f};
    if ~strcmp(wh_field,'info')
        CTDgrid.(wh_field)=zeros([Z,sum(indOK)]);
        for t=1:length(timerbrOK)
            F=Profiles{t}.(wh_field);
            [Psort,I]=sort(Profiles{t}.P,'descend');
            P_temp=(interp_sort(Psort));
            CTDgrid.(wh_field)(:,t)=interp1(P_temp,F(I),zaxis);
        end
    end
end
CTDgrid.z=zaxis;
CTDgrid.time=timerbrOK;

CTDgrid.z=zaxis;
CTDgrid.time=timerbrOK;
CTDgrid.info=CTDProfiles.info;

if exist(fullfile(Meta_Data.L1path,[Meta_Data.deployment '_grid.mat']),'file')
    load(fullfile(Meta_Data.L1path,[Meta_Data.deployment '_grid.mat']),'ADCPgrid')
    save(fullfile(Meta_Data.L1path,[Meta_Data.deployment '_grid.mat']),'CTDgrid','ADCPgrid')
else
    save(fullfile(Meta_Data.L1path,[Meta_Data.deployment '_grid.mat']),'CTDgrid')
end



level_sig=linspace(min(nanmean(sgth,2)),max(nanmean(sgth,2)),100);
for dt=1:numel(dnum)
    indnan=~isnan(sgth(:,dt));
    eta(:,dt)=interp1(sgth(indnan,dt),z(indnan),level_sig);
end
dvals2=floor(nanmean(eta,2)./2);
dmeta2=diff(dvals2);
eta2m=eta(dmeta2>0,:);


% epsilon 1 
fontsize=25;
figure(1);
colormap('parula')
pcolor(dnum,z,log10(real(epsilon1)));shading flat;axis ij
hold on
plot(dnum,eta2m,'Color',[.1,.1,.1,.6],'linewidth',1)
colorbar
caxis([-11,-5])
set(gca,'XTickLabelRotation',25)
datetick
cax=colorbar;
xlabel(['Start date :' datestr(dnum(1),'mm-dd-yyyy')],'fontsize',fontsize)
set(gca,'fontsize',fontsize)
ylabel(cax,'log_{10}(\epsilon)','fontsize',fontsize)
ylabel('Depth (m)','fontsize',fontsize)

fig=gcf;
fig.PaperPosition = [0 0 12 8];
fig.PaperOrientation='Portrait';
print(fullfile(Meta_Data.L1path,'Epsi1_map.png'),'-dpng2')

